---
import DesktopLayout from '../../layouts/DesktopLayout.astro';
import Window from '../../components/Window.astro';
---
<DesktopLayout title="SkiFree — Real Serious Business">
  <Window title="SkiFree" icon="/icons/win98/joystick.ico" path="/games/skifree" backHref="/games" defaultWidth={660} defaultHeight={540} defaultX={60} defaultY={20} noBodyScroll={true}>
    <div style="background:#fff;width:100%;height:100%;overflow:hidden;position:relative;">
      <canvas id="skifree-canvas" tabindex="0" style="width:100%;height:100%;display:block;outline:none;"></canvas>
    </div>
  </Window>
</DesktopLayout>

<!-- Intercept canvas.width/height setters BEFORE the game loads so it renders
     at the container's resolution instead of window.innerWidth × window.innerHeight.
     This makes all game objects appear at their intended size. -->
<script is:inline>
(function () {
  var canvas = document.getElementById('skifree-canvas');
  if (!canvas) return;
  var container = canvas.parentElement;
  var dpr = window.devicePixelRatio || 1;

  function cw() { return Math.max(container.offsetWidth  || 640, 320); }
  function ch() { return Math.max(container.offsetHeight || 480, 240); }

  var wDesc = Object.getOwnPropertyDescriptor(HTMLCanvasElement.prototype, 'width');
  var hDesc = Object.getOwnPropertyDescriptor(HTMLCanvasElement.prototype, 'height');

  Object.defineProperty(canvas, 'width', {
    get() { return wDesc.get.call(this); },
    set(_v) { wDesc.set.call(this, Math.round(cw() * dpr)); },
    configurable: true,
  });
  Object.defineProperty(canvas, 'height', {
    get() { return hDesc.get.call(this); },
    set(_v) { hDesc.set.call(this, Math.round(ch() * dpr)); },
    configurable: true,
  });
})();
</script>
<script is:inline src="/games/skifree/skifree.js"></script>

<style>
  /* Keep the canvas display-size within the window regardless of what the game
     sets via element.style.width/height (CSS !important beats JS inline style). */
  #skifree-canvas {
    width: 100% !important;
    height: 100% !important;
    image-rendering: pixelated;
  }
</style>
