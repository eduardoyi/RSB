---
import DesktopLayout from '../../layouts/DesktopLayout.astro';
import Window from '../../components/Window.astro';
import '../../styles/games.css';
---
<DesktopLayout title="Snake â€” Real Serious Business">
  <Window title="Snake" icon="/icons/win98/joystick_button.ico" path="/games/snake" backHref="/games" defaultWidth={520} defaultHeight={560} defaultX={80} defaultY={30} noBodyScroll={true}>
    <div style="background:silver;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:hidden;padding:6px;">
      <div style="position:relative;width:100%;max-width:480px;aspect-ratio:1;overflow:hidden;flex-shrink:0;box-shadow:inset 1px 1px #808080,inset -1px -1px #fff,inset 2px 2px #404040,inset -2px -2px #dfdfdf;">
        <canvas id="gameCanvas"></canvas>
        <!-- Win98-style score label -->
        <div id="score" class="snake-score">Score: 0</div>
        <!-- Win98 MessageBox-style game-over dialog -->
        <div id="gameOver" class="snake-gameover" style="display:none">
          <div class="snake-gameover-titlebar">Snake</div>
          <div class="snake-gameover-body">
            <p>Game Over!</p>
            <button onclick="restartGame()">Play Again</button>
          </div>
        </div>
      </div>
    </div>
  </Window>
</DesktopLayout>
<script src="/games/snake/snake.js" is:inline></script>
<script is:inline>
  // Swipe-to-steer for touch devices
  (function () {
    var canvas = document.getElementById('gameCanvas');
    var sx = 0, sy = 0;
    canvas.addEventListener('touchstart', function (e) {
      e.preventDefault();
      sx = e.touches[0].clientX;
      sy = e.touches[0].clientY;
    }, { passive: false });
    canvas.addEventListener('touchend', function (e) {
      e.preventDefault();
      var dx = e.changedTouches[0].clientX - sx;
      var dy = e.changedTouches[0].clientY - sy;
      if (Math.abs(dx) < 10 && Math.abs(dy) < 10) return; // ignore taps
      var key = Math.abs(dx) > Math.abs(dy)
        ? (dx > 0 ? 'ArrowRight' : 'ArrowLeft')
        : (dy > 0 ? 'ArrowDown' : 'ArrowUp');
      document.dispatchEvent(new KeyboardEvent('keydown', { key: key, bubbles: true }));
    }, { passive: false });
  })();
</script>
<style>
  #gameCanvas { width: 100%; height: 100%; display: block; }
</style>
